<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Random interval timer</title>
</head>

<body>
	<h1>Set sound frequency</h1>
	<p><button onclick="play();">play</button></p>
	<p><input id="input_freq" value="2000">[Hz]</p>
	<script>
		function play() {
			const input_freq = parseFloat(document.getElementById("input_freq").value);
			console.log('input_freq : ' + input_freq + ' : ' + typeof(input_freq));
			const ctx = new AudioContext();
			const oscillator = ctx.createOscillator();
			let current_time = ctx.currentTime;

			// const freqAndTime = [[400, 1], [300, 2]];
			// const freqAndTime = [[2500, 0.1], [0, 0.1], [2500, 0.1]];
			const freqAndTime = [[input_freq, 0.1]];
			for (const [freq, time] of freqAndTime) {
				oscillator.frequency.setValueAtTime(freq, current_time);
				current_time += time;
			}

			oscillator.connect(ctx.destination);
			oscillator.start(ctx.currentTime);
			oscillator.stop(current_time);
		}
		window.AudioContext = window.AudioContext || window.webkitAudioContext;
	</script>
	<h1>Start random interval timer</h1>
	<p><button onclick="Interval(this);" id="Interval">start</button></p>
	<p><input id="input_interval_min" value="0.5"> [sec] ~ <input id="input_interval_max" value="1.0"> [sec]</p>
	<script>
		function sleep(ms) {
			return new Promise(resolve => setTimeout(resolve, ms));
		}
		let canceled = false; // キャンセルフラグ
		async function Interval(button) {
			if (button.textContent == 'start') {
				button.textContent = "stop";
				canceled = false;

				const input_interval_min = parseFloat(document.getElementById("input_interval_min").value);
				const input_interval_max = parseFloat(document.getElementById("input_interval_max").value);
				console.log('input_interval_min : ' + input_interval_min + ' : ' + typeof(input_interval_min));
				console.log('input_interval_max : ' + input_interval_max + ' : ' + typeof(input_interval_max));
				while (true) {
					play();
					let random_gain = Math.random()
					console.log('random_gain : ' + random_gain + ' : ' + typeof(random_gain));
					let interval = random_gain * (input_interval_max - input_interval_min) + input_interval_min
					console.log('interval : ' + interval + ' : ' + typeof(interval));
					await sleep(interval * 1000)
					if (canceled) break;
					// break
				}
			}
			else if (button.textContent == 'stop') {
				button.textContent = "start";
				canceled = true;
			}
		}
	</script>
</body>

</html>
